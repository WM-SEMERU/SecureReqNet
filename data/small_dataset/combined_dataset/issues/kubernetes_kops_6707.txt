Deep-copy proto state to prevent concurrent modification


Fix #6635
