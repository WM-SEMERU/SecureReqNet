---

title: Deployment ðŸš€


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/10_deployment.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_deployment.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to /home/roger/nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Flask-Backend">Flask Backend<a class="anchor-link" href="#Flask-Backend"> </a></h2><p>Defines a factory for our app.  Serving is packaged nicely inside a serve method, and is ready to deploy with waitress.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Factory method for our application.  It returns an instance of our Flask application.  Default configuration has the TFX serving predict API on <a href="http://localhost:8503/v1/models/alpha:predict">http://localhost:8503/v1/models/alpha:predict</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_app" class="doc_header"><code>create_app</code><a href="https://github.com/rmclanton/SecureReqNet/blob/master/securereqnet/deployment.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_app</code>(<strong><code>test_config</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Returns a Flask web application with the default configuration pinging a TFX serving instance
on <a href="http://localhost:8503/v1/models/alpha:predict">http://localhost:8503/v1/models/alpha:predict</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using waitress, starts up a production server on the input host and port</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="serve" class="doc_header"><code>serve</code><a href="waitress.py#L5" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>serve</code>(<strong><code>app</code></strong>, <strong>**<code>kw</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The following are test cases for deployment</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">unittest.mock</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">mock</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">Mock</span>
<span class="kn">from</span> <span class="nn">securereqnet.deployment</span> <span class="kn">import</span> <span class="n">create_app</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">({</span><span class="s1">&#39;TESTING&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;TFX_ENDPOINT&quot;</span><span class="p">:</span> <span class="s2">&quot;MockMockMock&quot;</span><span class="p">})</span>
<span class="n">test_client</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Succeeds if the response code for default path is 200</span>
<span class="k">def</span> <span class="nf">test_app_homepage</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">test_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="o">==</span><span class="mi">200</span>

<span class="n">test_app_homepage</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This test checks if we are able to successfully post a sentence to the server and get a response back</span>
<span class="c1"># Mock the backend request to TFX serving</span>
<span class="c1"># Succeeds if data returns successfully in correct form</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;securereqnet.deployment.__get_predictions&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_prediction_single</span><span class="p">(</span><span class="n">mock_predictions</span><span class="p">):</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;test test test test&quot;</span><span class="p">]}</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]}</span>
    <span class="n">mock_predictions</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">expected_pred</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">test_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/models/alpha&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">test_payload</span><span class="p">)</span>
    <span class="n">r_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">r_data</span> <span class="o">==</span> <span class="n">expected_pred</span>

<span class="n">test_get_prediction_single</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;test test test test&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This test checks if we are able to successfully post multiple sentences to the server and get a response back</span>
<span class="c1"># Mock the backend request to TFX serving</span>
<span class="c1"># Succeeds if data returns successfully in correct form</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;securereqnet.deployment.__get_predictions&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_prediction_multi</span><span class="p">(</span><span class="n">mock_predictions</span><span class="p">):</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;test test test test&quot;</span><span class="p">,</span> <span class="s2">&quot;more testing&quot;</span><span class="p">,</span> <span class="s2">&quot;super duper testing&quot;</span><span class="p">]}</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]}</span>
    <span class="n">mock_predictions</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">expected_pred</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">test_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/models/alpha&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">test_payload</span><span class="p">)</span>
    <span class="n">r_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">r_data</span> <span class="o">==</span> <span class="n">expected_pred</span>

<span class="n">test_get_prediction_multi</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;test test test test&#39;, &#39;more testing&#39;, &#39;super duper testing&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This test checks if we are able to successfully post a blank to the server and get a response back</span>
<span class="c1"># Mock the backend request to TFX serving</span>
<span class="c1"># Succeeds if data returns with a blank result and no error</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;securereqnet.deployment.__get_predictions&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_prediction_blank</span><span class="p">(</span><span class="n">mock_predictions</span><span class="p">):</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">mock_predictions</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">expected_pred</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">test_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/models/alpha&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">test_payload</span><span class="p">)</span>
    <span class="n">r_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">r_data</span> <span class="o">==</span> <span class="n">expected_pred</span>

<span class="n">test_get_prediction_blank</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># checks if we can send a blank input and get a blank output with no error</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;requests.post&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_predictions_blank</span><span class="p">(</span><span class="n">mock_post</span><span class="p">):</span>
    <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">mock</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">predictions</span><span class="se">\&quot;</span><span class="s2">: []}&quot;</span><span class="p">)</span>
    <span class="n">mock_post</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">__get_predictions</span><span class="p">(</span><span class="n">test_payload</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected_pred</span><span class="o">==</span><span class="n">response</span>
    
<span class="n">test_get_predictions_blank</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Jason\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">UnboundLocalError</span>                         Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-43-27d47d8d9614&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">     11</span>     <span class="ansi-green-intense-fg ansi-bold">assert</span> expected_pred<span class="ansi-yellow-intense-fg ansi-bold">==</span>response
<span class="ansi-green-fg">     12</span> 
<span class="ansi-green-intense-fg ansi-bold">---&gt; 13</span><span class="ansi-yellow-intense-fg ansi-bold"> </span>test_get_predictions_blank<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">c:\python38\lib\unittest\mock.py</span> in <span class="ansi-cyan-fg">patched</span><span class="ansi-blue-intense-fg ansi-bold">(*args, **keywargs)</span>
<span class="ansi-green-fg">   1323</span>                                         args<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">   1324</span>                                         keywargs) as (newargs, newkeywargs):
<span class="ansi-green-intense-fg ansi-bold">-&gt; 1325</span><span class="ansi-yellow-intense-fg ansi-bold">                 </span><span class="ansi-green-intense-fg ansi-bold">return</span> func<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">*</span>newargs<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>newkeywargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">   1326</span> 
<span class="ansi-green-fg">   1327</span>         patched<span class="ansi-yellow-intense-fg ansi-bold">.</span>patchings <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">[</span>self<span class="ansi-yellow-intense-fg ansi-bold">]</span>

<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-43-27d47d8d9614&gt;</span> in <span class="ansi-cyan-fg">test_get_predictions_blank</span><span class="ansi-blue-intense-fg ansi-bold">(mock_post)</span>
<span class="ansi-green-fg">      8</span>     test_payload <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">      9</span>     expected_pred <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">{</span><span class="ansi-blue-intense-fg ansi-bold">&#34;predictions&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span> <span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">}</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 10</span><span class="ansi-yellow-intense-fg ansi-bold">     </span>response <span class="ansi-yellow-intense-fg ansi-bold">=</span> __get_predictions<span class="ansi-yellow-intense-fg ansi-bold">(</span>test_payload<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     11</span>     <span class="ansi-green-intense-fg ansi-bold">assert</span> expected_pred<span class="ansi-yellow-intense-fg ansi-bold">==</span>response
<span class="ansi-green-fg">     12</span> 

<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-3-8cc019dc5e1f&gt;</span> in <span class="ansi-cyan-fg">__get_predictions</span><span class="ansi-blue-intense-fg ansi-bold">(sentences, endpoint_uri)</span>
<span class="ansi-green-fg">      3</span> <span class="ansi-green-intense-fg ansi-bold">def</span> __get_predictions<span class="ansi-yellow-intense-fg ansi-bold">(</span>sentences<span class="ansi-yellow-intense-fg ansi-bold">,</span> endpoint_uri<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">      4</span>     payload = {
<span class="ansi-green-intense-fg ansi-bold">----&gt; 5</span><span class="ansi-yellow-intense-fg ansi-bold">             </span><span class="ansi-blue-intense-fg ansi-bold">&#34;instances&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span> vectorize_sentences<span class="ansi-yellow-intense-fg ansi-bold">(</span>sentences<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>tolist<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      6</span>         }
<span class="ansi-green-fg">      7</span> 

<span class="ansi-green-intense-fg ansi-bold">c:\users\jason\desktop\fall2020\swe\securereqnet\securereqnet\preprocessing.py</span> in <span class="ansi-cyan-fg">vectorize_sentences</span><span class="ansi-blue-intense-fg ansi-bold">(sentences)</span>
<span class="ansi-green-fg">    183</span>                 inp<span class="ansi-yellow-intense-fg ansi-bold">[</span>i<span class="ansi-yellow-intense-fg ansi-bold">,</span>words_rows<span class="ansi-yellow-intense-fg ansi-bold">,</span>embedding_cols<span class="ansi-yellow-intense-fg ansi-bold">,</span><span class="ansi-cyan-intense-fg ansi-bold">0</span><span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> embed_flatten<span class="ansi-yellow-intense-fg ansi-bold">[</span>embedding_cols<span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">    184</span>         <span class="ansi-red-intense-fg ansi-bold"># print(inp)</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 185</span><span class="ansi-yellow-intense-fg ansi-bold">     </span><span class="ansi-green-intense-fg ansi-bold">return</span> inp

<span class="ansi-red-intense-fg ansi-bold">UnboundLocalError</span>: local variable &#39;inp&#39; referenced before assignment</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># checks to see if we can post a single value which will decode as false</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;requests.post&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_predictions_single_false</span><span class="p">(</span><span class="n">mock_post</span><span class="p">):</span>
    <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">mock</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">predictions</span><span class="se">\&quot;</span><span class="s2">: [[0, 1]]}&quot;</span><span class="p">)</span>
    <span class="n">mock_post</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test test test test&quot;</span><span class="p">]</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">__get_predictions</span><span class="p">(</span><span class="n">test_payload</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected_pred</span><span class="o">==</span><span class="n">response</span>
    
<span class="n">test_get_predictions_single</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Jason\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># checks to see if we can send a single value which will decode as true</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;requests.post&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_predictions_single_true</span><span class="p">(</span><span class="n">mock_post</span><span class="p">):</span>
    <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">mock</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">predictions</span><span class="se">\&quot;</span><span class="s2">: [[1, 0]]}&quot;</span><span class="p">)</span>
    <span class="n">mock_post</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test test test test&quot;</span><span class="p">]</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">__get_predictions</span><span class="p">(</span><span class="n">test_payload</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected_pred</span><span class="o">==</span><span class="n">response</span>
    
<span class="n">test_get_predictions_single_true</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Jason\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># checks to see if we can test a nonbinary prediction on a single input and get true</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;requests.post&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_predictions_single_true_nonbinary</span><span class="p">(</span><span class="n">mock_post</span><span class="p">):</span>
    <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">mock</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">predictions</span><span class="se">\&quot;</span><span class="s2">: [[0.9, 0.2]]}&quot;</span><span class="p">)</span>
    <span class="n">mock_post</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test test test test&quot;</span><span class="p">]</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">__get_predictions</span><span class="p">(</span><span class="n">test_payload</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected_pred</span><span class="o">==</span><span class="n">response</span>
    
<span class="n">test_get_predictions_single_true_nonbinary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Jason\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># checks to see if we can test a nonbinary prediction on a single input and get false</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;requests.post&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_predictions_single_false_nonbinary</span><span class="p">(</span><span class="n">mock_post</span><span class="p">):</span>
    <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">mock</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">predictions</span><span class="se">\&quot;</span><span class="s2">: [[0.2, 0.9]]}&quot;</span><span class="p">)</span>
    <span class="n">mock_post</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test test test test&quot;</span><span class="p">]</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">__get_predictions</span><span class="p">(</span><span class="n">test_payload</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected_pred</span><span class="o">==</span><span class="n">response</span>
    
<span class="n">test_get_predictions_single_false_nonbinary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Jason\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># tests if we can get multiple true predictions from strings</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;requests.post&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_predictions_multi_true</span><span class="p">(</span><span class="n">mock_post</span><span class="p">):</span>
    <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">mock</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">predictions</span><span class="se">\&quot;</span><span class="s2">: [[1, 0], [1, 0], [1, 0]]}&quot;</span><span class="p">)</span>
    <span class="n">mock_post</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test test test test&quot;</span><span class="p">,</span> <span class="s2">&quot;test test test test&quot;</span><span class="p">,</span> <span class="s2">&quot;test test test test&quot;</span><span class="p">]</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">__get_predictions</span><span class="p">(</span><span class="n">test_payload</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected_pred</span><span class="o">==</span><span class="n">response</span>
    
<span class="n">test_get_predictions_multi_true</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Jason\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># tests if we can get multiple false predictions from strings</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;requests.post&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_predictions_multi_false</span><span class="p">(</span><span class="n">mock_post</span><span class="p">):</span>
    <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">mock</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">predictions</span><span class="se">\&quot;</span><span class="s2">: [[0, 1], [0, 1], [0, 1]]}&quot;</span><span class="p">)</span>
    <span class="n">mock_post</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test test test test&quot;</span><span class="p">,</span> <span class="s2">&quot;test test test test&quot;</span><span class="p">,</span> <span class="s2">&quot;test test test test&quot;</span><span class="p">]</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">__get_predictions</span><span class="p">(</span><span class="n">test_payload</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected_pred</span><span class="o">==</span><span class="n">response</span>
    
<span class="n">test_get_predictions_multi_false</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Jason\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># tests if we can get multiple mixed predictions from strings</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;requests.post&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_get_predictions_multi_mixed</span><span class="p">(</span><span class="n">mock_post</span><span class="p">):</span>
    <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">mock</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">predictions</span><span class="se">\&quot;</span><span class="s2">: [[0, 1], [1, 0], [0, 1], [1, 0]]}&quot;</span><span class="p">)</span>
    <span class="n">mock_post</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock</span>
    <span class="n">test_payload</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test test test test&quot;</span><span class="p">,</span> <span class="s2">&quot;test test test test&quot;</span><span class="p">,</span> <span class="s2">&quot;test test test test&quot;</span><span class="p">,</span> <span class="s2">&quot;test test test test&quot;</span><span class="p">]</span>
    <span class="n">expected_pred</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">__get_predictions</span><span class="p">(</span><span class="n">test_payload</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected_pred</span><span class="o">==</span><span class="n">response</span>
    
<span class="n">test_get_predictions_multi_mixed</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\Jason\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

