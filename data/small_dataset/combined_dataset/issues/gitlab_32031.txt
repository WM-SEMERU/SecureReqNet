'The fixes from #31341 should go into the current branches.

# `master`

## CE & EE !11230

- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2097 (2086)
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2098 (2088)
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2084 
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2087 
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2089
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2093
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2094
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2095
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2085 - Merged by @jschatz1 in https://gitlab.com/gitlab-org/gitlab-ce/commit/3aeae2c7fa22630edc8f1f29bbbdf0f7bb40e15e
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2096

## EE only https://gitlab.com/gitlab-org/gitlab-ee/merge_requests/1864

- [x] https://dev.gitlab.org/gitlab/gitlab-ee/merge_requests/508
- [x] https://dev.gitlab.org/gitlab/gitlab-ee/merge_requests/509

# `9-2-stable` https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/11234

- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2097 (2086)
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2098 (2088)
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2084
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2087
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2089
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2093
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2094
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2095
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2085
- [x] https://dev.gitlab.org/gitlab/gitlabhq/merge_requests/2096

## EE only

- [x] https://dev.gitlab.org/gitlab/gitlab-ee/merge_requests/508
- [x] https://dev.gitlab.org/gitlab/gitlab-ee/merge_requests/509